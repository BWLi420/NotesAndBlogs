> 多线程在iOS中的地位至关重要，不论是找工作面试，还是日常的工作开发过程中都会经常涉及。因此，学好多线程就显得尤其重要了，想要学好多线程需要对它的基础知识有所了解，本篇文章旨在简单介绍基础，如有不当，欢迎指正。

# 进程

1. 进程是指在系统中正在运行的一个应用程序
2. 每个进程之间是独立的，每个进程均运行在其专用且受保护的内存空间内

# 线程

1. 基本概念

		a. 1个进程要想执行任务，必须得有线程（每1个进程至少要有1条线程）
		b. 线程是进程的基本执行单元，一个进程（程序）的所有任务都在线程中执行
2. 线程的串行

		a. 1个线程中任务的执行是串行的
		b. 如果要在1个线程中执行多个任务，那么只能一个一个地按顺序执行这些任务
		c. 也就是说，在同一时间内，1个线程只能执行1个任务

# 多线程

1. 基本概念

		即1个进程中可以开启多条线程，每条线程可以并行（同时）执行不同的任务
2. 线程的并行

		并行即同时执行。比如同时开启3条线程分别下载3个文件（分别是文件A、文件B、文件C）
3. 多线程并发执行的原理

		a. 在同一时间里，CPU只能处理 1 条线程，只有 1 条线程在工作（执行）
		b. 多线程并发（同时）执行，其实是CPU快速地在多条线程之间调度（切换），如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象
4. 多线程优缺点

	4.1 优点
	
		a. 能适当提高程序的执行效率
		b. 能适当提高资源利用率（CPU、内存利用率）
	4.2 缺点
	
		a. 开启线程需要占用一定的内存空间（默认情况下，主线程占用1M，子线程占用512KB），如果开启大量的线程，会占用大量的内存空间，降低程序的性能
		b. 线程越多，CPU在调度线程上的开销就越大
		c. 程序设计更加复杂：比如线程之间的通信、多线程的数据共享

## 多线程在iOS开发中的应用

1. 主线程

		a. 一个iOS程序运行后，默认会开启 1 条线程，称为“主线程”或“UI 线程”
		b. 作用：刷新显示 UI，处理 UI 事件
2. 子线程

		a. 除了主线程之外的所有线程，也叫做后台线程
		b. 子线程不能用来刷新 UI
3. 使用注意

		a. 不要将耗时操作放到主线程中去处理，因为会卡住线程
		b. 和UI相关的刷新操作必须放到主线程中进行处理

## iOS中多线程的实现方案

1. pthread

		a. 特点：
			（1）一套通用的多线程API
			（2）适用于 Unix\Linux\Windows 等系统
			（3）跨平台\可移植
			（4）使用难度大		
		b. 使用语言：C语言
		c. 使用频率：几乎不用
		d. 线程生命周期：由程序员进行管理
2. NSThread

		a. 特点：
			（1）使用更加面向对象
			（2）简单易用，可直接操作线程对象
		b. 使用语言：OC语言
		c. 使用频率：偶尔使用
		d. 线程生命周期：由程序员进行管理
3. GCD

		a. 特点：	
			（1）旨在替代 NSThread 等线程技术
			（2）充分利用设备的多核（自动）
		b. 使用语言：C语言
		c. 使用频率：经常使用
		d. 线程生命周期：自动管理
4. NSOperation

		a. 特点：
			（1）基于GCD（底层是GCD）
			（2）比GCD多了一些更简单实用的功能
			（3）使用更加面向对象
		b. 使用语言：OC语言
		c. 使用频率：经常使用
		d. 线程生命周期：自动管理

# 线程的状态与安全

1. 线程的状态
	- 新建、就绪、运行、阻塞、死亡
	![线程的五种状态](https://tva1.sinaimg.cn/large/006y8mN6gy1g8qtvkrjuqj30ju05egn2.jpg)
	- *注意* ：==线程死亡之后不能重新开启
2. 线程安全问题
	- 安全隐患
		- 当多个线程访问同一块资源时，很容易引发数据错乱和数据安全问题，比如多个线程访问同一个对象、同一个变量、同一个文件
	![安全隐患](https://tva1.sinaimg.cn/large/006y8mN6gy1g8qtvlnsf1j30ey07u74p.jpg)
		- 如上图所示，当线程 A 进行计算的同时，线程 B 也进行计算，最终的结果就会产生偏差
	- 解决方案
		- 添加互斥锁
	  ![添加互斥锁解决隐患](https://tva1.sinaimg.cn/large/006y8mN6gy1g8qtvm2pf3j30g209i74w.jpg)
		
		- 添加互斥锁之后，一次只能有一个线程进行访问资源，只有线程 A 访问完毕释放资源，线程 B 才能进行访问
		
		- 互斥锁的使用格式
		
		  ```objective-c
		  @synchronized(锁对象) { 
		  // 锁对象一般使用 self
		  // 需要锁定的代码
		  }
		  ```
		```
		- *注意：* 互斥锁能有效防止多线程抢夺资源造成的数据安全问题，但是会消耗大量资源，在实际开发中不要乱加互斥锁。
		```

